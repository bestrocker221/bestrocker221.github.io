<!DOCTYPE html>
<html lang="en-EN">
  <head>
    
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="msvalidate.01" content="2968909B8A7C9E7281129471CA8D69D9" />
        <link rel="shortcut icon" type="image/x-icon" href="/assets/icons/network.png" />
        <title>How to do create and manage Amazon IAM users with Terraform - Carlo Alberto Scola</title>
        <meta name="author" content="Carlo Alberto Scola" />
        <meta name="description" content="How to do create and manage Amazon IAM users with Terraform" />
        <meta name="keywords" content="How to do create and manage Amazon IAM users with Terraform, Carlo Alberto Scola, linux, terraform" />

        <meta content="1082525865223478" property="fb:app_id">
        <meta content="Carlo Alberto Scola" property="og:site_name">
        
          <meta content="How to do create and manage Amazon IAM users with Terraform" property="og:title">
        
        
          <meta content="article" property="og:type">
        
        
          <meta content="How to easily manage IAM users with Terraform in AWS. Create and manage users and access keys in a fast and reproducible manner." property="og:description">
        
        
          <meta content="https://carloalbertoscola.it//2023/linux/terraform/how-to-manage-iam-users-terraform-aws/" property="og:url">
        
        
          <meta content="2023-04-15T00:00:00+02:00" property="article:published_time">
          <meta content="https://carloalbertoscola.it//about/" property="article:author">
        
        
          <meta content="https://carloalbertoscola.it//static/img/logo-high-resolution.png" property="og:image">
        
        
          
          <meta content="linux" property="article:section">
          
        
        
          
          <meta content="linux" property="article:tag">
          
          <meta content="infrastructure" property="article:tag">
          
          <meta content="terraform" property="article:tag">
          
        
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@carloa_scola">
        <meta name="twitter:creator" content="@carloa_scola">
        
          <meta name="twitter:title" content="How to do create and manage Amazon IAM users with Terraform">
        
        
          <meta name="twitter:url" content="https://carloalbertoscola.it//2023/linux/terraform/how-to-manage-iam-users-terraform-aws/">
        
        
          <meta name="twitter:description" content="How to easily manage IAM users with Terraform in AWS. Create and manage users and access keys in a fast and reproducible manner.">
        
        

    
      <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
      <script type="text/javascript">window.baseurl = 'https://carloalbertoscola.it/';</script>
              <!-- Custom Fonts 
        <link href="https://fonts.googleapis.com/css?family=Fira+Mono&display=swap" rel="stylesheet">
-->     
        <link href="/static/css/FiraMono.css" rel="stylesheet">
        <!-- Custom Fonts 
        <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
-->

        <!-- FontAwesome icons -->
        <!--<link rel="stylesheet" href="https://use.fontawesome.com/74dfc6cf47.css">-->
        <!-- 
        <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
        -->
        
        <link href="/static/css/all.css" rel="stylesheet">

        <!-- Core BootStrap CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap.min.css">
        
        <!-- Material Design CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-material-design.min.css">

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/static/css/syntax.css">

        <!-- Custom CSS -->        
        <link rel="stylesheet" href="/static/css/thickbox.css">
        <link rel="stylesheet" href="/static/css/main.css">
        <link rel="stylesheet" href="/static/css/projects.css">

        <script type="text/javascript">
          //loadingImage is relative to project dir
          var tb_pathToImage = "/static/img/loadingAnimation.gif";
        </script>

        <link href="/static/css/montserrat-robo.css" rel="stylesheet">

      <link rel="stylesheet" type="text/css" href="/static/css/cookieconsent.min.css" />
<script src="/static/js/cookieconsent.min.js"></script>
<script>

function getCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
}

function setCookie(name,value,days) {
    var expires = "";
    if (days) {
        var date = new Date();
        date.setTime(date.getTime() + (days*24*60*60*1000));
        expires = "; expires=" + date.toUTCString();
    }
    document.cookie = name + "=" + (value || "")  + expires + "; path=/; domain=.carloalbertoscola.it";
}

function delete_cookie( name ) {
  document.cookie = name + '=; Path=/;domain=.carloalbertoscola.it; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
}

function disableCookies(){
  var cookies = ["_gat", "_gid", "_ga"];
  cookies.forEach( function(element, index) {
    // statements
    console.log("deleting: " + element);
    delete_cookie(element);
    //setCookie("cookieconsent_status", "deny", 7);
    //window.location.reload(true);
  });
}

window.addEventListener("load", function(){
  window.cookieconsent.initialise({
    "palette": {
      "popup": {
        "background": "#000"
      },
      "button": {
        "background": "#f1d600"
      }
    },
    "theme": "classic",
    "type": "opt-out",
    "content": {
      "message": "This website uses cookies just to get simple stats and help understand if the content of the website is viewed or not.\n",
      "href": "https://carloalbertoscola.it/cookies"
    },
    onInitialise: function (status) {
    //console.log("init");
    var type = this.options.type;
    var didConsent = this.hasConsented();
    if (type == 'opt-in' && didConsent) {
      // enable cookies
      }
    if (type == 'opt-out' && !didConsent) {
      // disable cookies
      //disableCookies();
      }
    },
   onStatusChange: function(status, chosenBefore) {
    //console.log("change");
    var type = this.options.type;
    var didConsent = this.hasConsented();
    if (type == 'opt-in' && didConsent) {
      // enable cookies
    }
    if (type == 'opt-out' && !didConsent) {
      // disable cookies
      disableCookies();
      window.location.reload(true);
    }
    if(type == 'opt-out' && didConsent){
      window.location.reload(true);
    }
  },
  onRevokeChoice: function() {
    //console.log("rev");
    var type = this.options.type;
    if (type == 'opt-in') {
      // disable cookies
      disableCookies();
    }
    if (type == 'opt-out') {
      // enable cookies
    }
  }
  })
});
</script>
  </head>

  <body class="home overflow-hidden">
    <div class="header-panel shadow-z-2">
      <div class="container">
        <div class="row headrow">
          <div class="col-md-3 col-sm-4 col-xs-12">
            <div class="row-picture">
              <a href="/"><img id="about" class="logo-img" src="/assets/scola-carlo-alberto.jpg" height="75px" width="75px"></a>
            </div>
            <div class="row-details">
              <h4 class="list-group-item-heading"><a href="/" style="color:white;">Carlo Alberto Scola</a></h4>
              <p class="list-group-item-text">Cyber Security passionate</p>
              <div class="social-icons" style="display: initial !important;">
	
        <a class="icon" target="_blank" href="https://github.com/bestrocker221"><i class="fab fab fa-github" ></i></a>
    
        <a class="icon" target="_blank" href="https://www.linkedin.com/in/carlo-alberto-scola-75653b128/"><i class="fab fa-linkedin" ></i></a>
    
        <a class="icon" target="_blank" href="https://twitter.com/carloa_scola"><i class="fab fa-twitter" ></i></a>
    
        <a class="icon" target="_blank" href="https://www.instagram.com/carloalberto_22"><i class="fab fa-instagram" ></i></a>
    
</div>

            </div>
            <div class="navbar-header pull-right">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-2x fa-bars"></i>
              </button>
            </div>
          </div>
          <div class="col-md-9 col-sm-8 col-xs-12 title-search-row">
          <div class="row">
            <h2 class="blog-title-pro col-md-9 col-sm-12 col-xs-12 ">How to do create and manage Amazon IAM users with Terraform</h2>
            
            <div class="col-md-3 col-sm-12 col-xs-12 searchcontrol" id="js-search">
              <input class="form-control" type="text" id="js-search__input" placeholder="Search">
              <ul class="search__results" id="js-search__results"></ul>
            </div>
            
            </div>
            <p class="info">
              
                <span class="time">15 Apr 2023</span>
              
              
                <span class="categories">
                  &raquo; categories:
                  
                    <a href="/linux">linux</a>
                    , 
                  
                    <a href="/terraform">terraform</a>
                    
                  
                </span>
              
            </p>
          </div>
          
        </div>
      </div>
    </div>

    <div class="container main outer">
      <div class="row">
        <div id="menu-div" class="col-md-3 col-xs-12 menu-div">
              <nav class="menu">
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
    <ul class="list-separator nav navbar-nav well well-primary post">

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12 current-menu-item how-to-manage-iam-users-terraform-aws"><a href="/" target="_self"><i class="fa fa-home"></i> Home</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/linux" target="_self"><i class="fab fa-linux"></i> Linux</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/security" target="_self"><i class="fas fa-lock"></i> Security</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/web" target="_self"><i class="fas fa-globe"></i> Web</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/notes" target="_self"><i class="fas fa-book"></i> Notes</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/python" target="_self"><i class="fab fa-python"></i> Python</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/photography" target="_self"><i class="fas fa-camera"></i> Photography</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/about/" target="_self"><i class="fa fa-comments"></i> About</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/projects" target="_self"><i class="fa fa-desktop"></i> Projects</a></li>

	
	
	
	
	
	
    
	
	<li class="col-lg-12 col-md-12 col-sm-4 col-xs-12  how-to-manage-iam-users-terraform-aws"><a href="/static/Curriculum_Vitae_Carlo_Alberto_Scola-en.pdf" target="_blank"><i class="fa fa-graduation-cap"></i> Resume</a></li>

</ul>

    </div>
    </nav>

        </div>
        <div class="col-md-9 col-xs-12 full">
          <div class="post-content well">
<article class="content">
    <div class="post"><h1 id="automating-aws-iam-user-management-with-terraform"><strong><center>Automating AWS IAM User Management with Terraform</center></strong></h1>
<h2 id="a-guide-to-quickly-create-and-manage-iam-users-and-roles-in-aws-with-terraform"><center>A guide to quickly create and manage IAM users and roles in AWS with Terraform</center></h2>

<p><em>Last modified:</em> 16 April 2023</p>

<p>This post is part of a series of <strong><a href="https://www.terraform.io/">Terraform</a></strong> posts related to making AWS deployment less cumbersome and more efficient. In this post, we’ll dive into the process of automating part of the IAM user management using Terraform.</p>

<p>AWS IAM (Identity and Access Management) is a service that enables you to manage access to AWS resources securely. Creating and managing IAM users and roles through the AWS management portal can be a time-consuming process, especially when you have a large number of users to manage. Terraform can help you automate this process with the “write-once-reuse-many” principle.</p>

<p>Infrastructure as code is becoming increasingly popular, and Terraform is a popular tool for implementing it. In this post, we’ll show you how to use Terraform to create IAM users, associate a user profile with a generated password, create access keys, and attach security policies to the user.</p>

<p>Before we get started, here’s what you’ll need:</p>

<ol>
  <li>Terraform</li>
  <li>Keybase (for user password encryption)</li>
  <li>AWS account</li>
</ol>

<p>The post will not go into details on what is what, so let’s dive into the practical part.</p>
<ol>
  <li>Create new IAM users</li>
  <li>Associate a user profile with a generated password</li>
  <li>Create access keys</li>
  <li>Attach security policies to the user</li>
</ol>

<h2 id="project-structure">Project structure</h2>
<p>The folder structure will be as follow:</p>
<ul>
  <li><strong>main.tf</strong> (main login)</li>
  <li><strong>policies.tf</strong> (define the user policies)</li>
  <li><strong>output.tf</strong> (define the outputs)</li>
  <li><strong>variables.tf</strong> (store the user variables)</li>
</ul>

<h2 id="getting-started-with-terraform-aws-provider">Getting started with Terraform AWS Provider</h2>
<p>To get started with Terraform AWS Provider, include the necessary module in the main.tf file as shown below:</p>

<figure class="highlight"><pre><code class="language-terraform" data-lang="terraform"><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">required_providers</span> <span class="p">{</span>
    <span class="nx">aws</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">source</span>  <span class="p">=</span> <span class="s2">"hashicorp/aws"</span>
      <span class="nx">version</span> <span class="p">=</span> <span class="s2">"~&gt; 3.0"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>In the <strong>variables.tf</strong> file, firstly define the AWS provider with its zone, then define the variables. You can define a list of users to be created as follows:</p>

<figure class="highlight"><pre><code class="language-terraform" data-lang="terraform"><span class="k">provider</span> <span class="s2">"aws"</span> <span class="p">{</span>
  <span class="nx">region</span> <span class="p">=</span> <span class="s2">"eu-north-1"</span>
<span class="p">}</span>

<span class="k">variable</span> <span class="s2">"username_list"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="p">=</span> <span class="s2">"List of equal users to create"</span>
  <span class="nx">type</span>        <span class="p">=</span> <span class="nx">map</span><span class="p">(</span><span class="nx">any</span><span class="p">)</span>
  <span class="nx">default</span> <span class="p">=</span> <span class="p">{</span>
    <span class="nx">mark</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">access_key_status</span>     <span class="p">=</span> <span class="s2">"Active"</span>
    <span class="p">},</span>
    <span class="nx">john</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">access_key_status</span>     <span class="p">=</span> <span class="s2">"Active"</span>
    <span class="p">}</span>
  <span class="p">}</span>  
<span class="p">}</span></code></pre></figure>

<p>In this example, we’ve defined two dictionaries containing the user’s name and the access key status that will later define whether the key should be enabled or not.</p>

<p>Next, we’ll jump back to the <strong>main.tf</strong> file to define the three main resources needed to create IAM users: <code class="language-plaintext highlighter-rouge">aws_iam_user</code>, <code class="language-plaintext highlighter-rouge">aws_iam_access_key</code>, and <code class="language-plaintext highlighter-rouge">aws_iam_user_login_profile</code>. If you do not want a web console login, then skip the login profile section.</p>

<p>These can be defined as follow, note some string variables can be defined and added in the <strong>variables.tf</strong></p>

<figure class="highlight"><pre><code class="language-terraform" data-lang="terraform"><span class="k">resource</span> <span class="s2">"aws_iam_user"</span> <span class="s2">"new_user"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">username_list</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">key</span>
  <span class="nx">path</span> <span class="p">=</span> <span class="s2">"/</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">project_name</span><span class="k">}</span><span class="s2">/"</span>
  <span class="nx">force_destroy</span> <span class="p">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_iam_access_key"</span> <span class="s2">"new_user_access_key"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">username_list</span>
  <span class="nx">user</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">key</span>
  <span class="nx">pgp_key</span> <span class="p">=</span> <span class="s2">"keybase:</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">deployer_keybase</span><span class="k">}</span><span class="s2">"</span>
  
  <span class="c1"># change the variables file to disallow a user's access key</span>
  <span class="nx">status</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">access_key_status</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"aws_iam_user_login_profile"</span> <span class="s2">"new_user_login_profile"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">username_list</span>
  <span class="nx">user</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">key</span>
  <span class="nx">password_length</span> <span class="p">=</span> <span class="mi">40</span>
  <span class="nx">pgp_key</span> <span class="p">=</span> <span class="s2">"keybase:</span><span class="k">${</span><span class="kd">var</span><span class="p">.</span><span class="nx">deployer_keybase</span><span class="k">}</span><span class="s2">"</span>  
<span class="p">}</span></code></pre></figure>

<p>This is all for the <strong>main.tf</strong>. Awesome isn’t it?</p>

<p>Now some explanation.</p>

<ul>
  <li>The <strong>for_each</strong> Terraform construct will create a loop and replicate the same instructions for each element contained in the value assigned. In this case, it will scroll through the <em>username_list</em> and replicate the same resource.</li>
  <li><strong>key</strong> and <strong>value</strong> are the two attribute of the <em>for_each</em> construct.</li>
  <li><strong>pgp_key</strong> contains a reference to a Keybase user in the form “keybase:username”. This will instruct Terraform to fetch the public PGP key of said user and use that key to encrypt the secret generated at runtime. This way, multiple users can be created and their secrets get automatically encrypted with their PGP public key.</li>
  <li><strong>status</strong> in the <em>aws_iam_access_key</em> define if the access key associated to the user is enabled or not.</li>
</ul>

<h2 id="how-to-attach-policies-to-a-user">How to attach policies to a user</h2>
<p>In the <strong>policies.tf</strong> we can define IAM user policies and attach them to each user.</p>

<p>This policy example allows the user to perform S3 operations (ListBucket, GetObject, and PutObject) on the “example-bucket” S3 bucket and its objects, but denies all S3 operations on objects not located in the “logs” directory within the bucket.</p>

<figure class="highlight"><pre><code class="language-terraform" data-lang="terraform"><span class="k">resource</span> <span class="s2">"aws_iam_user_policy"</span> <span class="s2">"policy_s3_example"</span> <span class="p">{</span>
  <span class="nx">for_each</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">username_list</span>
  <span class="nx">user</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">key</span>
  <span class="nx">name</span> <span class="p">=</span> <span class="s2">"s3-example"</span>
  <span class="nx">policy</span> <span class="p">=</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh">
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket",
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": [
                "arn:aws:s3:::example-bucket",
                "arn:aws:s3:::example-bucket/*"
            ]
        },
        {
            "Effect": "Deny",
            "Action": "s3:*",
            "NotResource": [
                "arn:aws:s3:::example-bucket/logs/*"
            ]
        }
    ]
}
</span><span class="no">EOF
</span><span class="p">}</span></code></pre></figure>

<h2 id="the-terraform-output-file">The Terraform output file</h2>
<p>The <strong>output.tf</strong> defines the Terraform outputs. These can be either through console, or i.e. to file.</p>

<p>In this example we want to print out the generated users, and create a file for each user generated containing the credentials information.</p>

<p>To simplify this task, a Template is created. A template file will be fed into Terraform, which in turn will populate it with the variables defined and spit out the final file.</p>

<p>This is for example, a template file named  <strong>user_creds.tmpl</strong>.</p>
<pre><code class="language-txt">Username: ${username}
PGP Password: ${password}
AccessKeyID: ${access_key_id}
PGP SecretAccessKey: ${secret_access_key}
AWS Login URL: ${aws_login_url}
</code></pre>

<p>The <code class="language-plaintext highlighter-rouge">${username}</code> format string in the template will be populated with the <code class="language-plaintext highlighter-rouge">username</code> variable.</p>

<p>This is the content of <strong>output.tf</strong></p>

<figure class="highlight"><pre><code class="language-terraform" data-lang="terraform"><span class="k">output</span> <span class="s2">"users_created"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="p">[</span>
    <span class="nx">for</span> <span class="nx">new_u</span> <span class="nx">in</span> <span class="nx">aws_iam_user</span><span class="p">.</span><span class="nx">new_user</span> <span class="err">:</span> <span class="nx">new_u</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="k">resource</span> <span class="s2">"local_file"</span> <span class="s2">"user_creds"</span> <span class="p">{</span>
    <span class="nx">for_each</span> <span class="p">=</span> <span class="nx">aws_iam_user</span><span class="p">.</span><span class="nx">new_user</span>
    <span class="nx">filename</span> <span class="p">=</span> <span class="s2">"output/user_creds_</span><span class="k">${</span><span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">.conf"</span>

    <span class="nx">content</span> <span class="p">=</span> <span class="nx">templatefile</span><span class="p">(</span><span class="s2">"templates/user_creds.tmpl"</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">username</span> <span class="p">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
        <span class="nx">password</span> <span class="p">=</span> <span class="nx">aws_iam_user_login_profile</span><span class="p">.</span><span class="nx">new_user_login_profile</span><span class="p">[</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="p">].</span><span class="nx">encrypted_password</span><span class="p">,</span>
        <span class="nx">access_key_id</span> <span class="p">=</span> <span class="nx">aws_iam_access_key</span><span class="p">.</span><span class="nx">new_user_access_key</span><span class="p">[</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="p">].</span><span class="nx">id</span><span class="p">,</span>
        <span class="nx">secret_access_key</span> <span class="p">=</span> <span class="nx">aws_iam_access_key</span><span class="p">.</span><span class="nx">new_user_access_key</span><span class="p">[</span><span class="nx">each</span><span class="p">.</span><span class="nx">key</span><span class="p">].</span><span class="nx">secret</span><span class="p">,</span>
        <span class="nx">aws_login_url</span> <span class="p">=</span> <span class="kd">var</span><span class="p">.</span><span class="nx">aws_login_url</span>
    <span class="p">})</span>
    <span class="nx">file_permission</span> <span class="p">=</span> <span class="s2">"0644"</span>
<span class="p">}</span></code></pre></figure>

<p>This is all!</p>

<h2 id="how-to-run-the-terraform-code">How to run the Terraform code</h2>
<p>We are now ready to run the Terraform code.</p>

<ol>
  <li>First, initialize the working directory by running <code class="language-plaintext highlighter-rouge">terraform init</code> in the same directory as the Terraform configuration file.</li>
  <li>Then, review the changes that Terraform will make by running <code class="language-plaintext highlighter-rouge">terraform plan</code>. This command will create an execution plan that shows the changes that Terraform will make to the infrastructure.</li>
  <li>If the execution plan looks correct, we can apply the changes by running <code class="language-plaintext highlighter-rouge">terraform apply</code>.</li>
</ol>

<p>Note that some of the resources in our Terraform code will create IAM users, which may incur charges on your AWS account.</p>

<p>If a user’s access key needs to be disabled, just change its value in the <em>variables.tf</em> file and <code class="language-plaintext highlighter-rouge">terraform apply</code> to make it happen.</p>

<h1 id="conclusion">Conclusion</h1>
<p>In this post, we have shown how to use Terraform to automate the creation and management of IAM users in AWS. By defining the user variables and their policies in the Terraform configuration files, we can quickly create and manage multiple IAM users with ease.</p>

<p>IAM user management can be quite time-consuming when done manually through the AWS management portal. By using Terraform, we can reduce the time and effort required to manage IAM users in AWS.</p>

<p>I hope you found this post helpful. If you have any questions or feedback, feel free to leave a comment below.</p>

</div>
    <hr />
    <ul class="social-share-list">
	<li>
		<div class="share-page">
			Share this on &rarr;
			<a href="https://twitter.com/share" class="twitter-share-button" data-via="carloa_scola">Tweet</a>
			<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://carloalbertoscola.it//static/js/twitter-widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></li>
		<li><!-- TWITTER FOLLOW -->
			<a href="https://twitter.com/carloa_scola?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @carloa_scola</a><script async src="/static/js/twitter-widgets.js" charset="utf-8"></script></li>
		<li><!-- Linkedin -->
			<script src="/static/js/linkedin-in.js" type="text/javascript">lang: en_US</script>
			<script type="IN/Share" data-url="https://carloalbertoscola.it//2023/linux/terraform/how-to-manage-iam-users-terraform-aws/"></script></li>
		<li><!-- Facebook -->
			<div class="fb-share-button" data-href="https://carloalbertoscola.it//2023/linux/terraform/how-to-manage-iam-users-terraform-aws/" data-layout="button_count" style="position: relative; top: -6px; left: 3px;"></div>
			</div>
			<div id="fb-root"></div>
			<script>(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) return;
			js = d.createElement(s); js.id = id;
			js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=1082525865223478";
			fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));</script>
		</li>
</ul>


<!--
https://twitter.com/intent/follow?original_referer=https://carloalbertoscola.it//2023/linux/terraform/how-to-manage-iam-users-terraform-aws/&screen_name=carloa_scola&tw_p=followbutton

https://twitter.com/intent/tweet?original_referer=https://carloalbertoscola.it//2023/linux/terraform/how-to-manage-iam-users-terraform-aws/&ref_src=twsrc%5Etfw&text={}%20-%20Carlo%20Alberto%20Scola&tw_p=tweetbutton&url=https://carloalbertoscola.it//2023/linux/terraform/how-to-manage-iam-users-terraform-aws/&via=carloa_scola

-->
</article>
<hr />


    
    
        
            
                
                <div class="panel-body">
                <h4>Related Posts</h4>
                <ul>
                
                <li class="relatedPost">
                    <a href="https://carloalbertoscola.it//2023/linux/infrastructure/how-to-update-dynamic-ip-cloudflare/">How to update dynamic DNS records with Cloudflare API</a>
                    
                        <small>(Categories: <a href="/linux">linux</a>, <a href="/infrastructure">infrastructure</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="https://carloalbertoscola.it//2023/linux/how-to-setup-webhook-authentik-notification/">How to use custom webhooks in Authentik</a>
                    
                        <small>(Categories: <a href="/linux">linux</a>)</small>
                    
                </li>
                
                
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="https://carloalbertoscola.it//2023/linux/docker/security/how-to-securely-run-docker-containers/">How to securely run Docker containers</a>
                    
                        <small>(Categories: <a href="/linux">linux</a>, <a href="/docker">docker</a>, <a href="/security">security</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
                
                <li class="relatedPost">
                    <a href="https://carloalbertoscola.it//2020/security/linux/network/Rsync-Encfs-remote-cloud-backup-how-to/">A secure, easy and encrypted cloud backup</a>
                    
                        <small>(Categories: <a href="/security">security</a>, <a href="/linux">linux</a>, <a href="/network">network</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
                
                <li class="relatedPost">
                    <a href="https://carloalbertoscola.it//2019/network/security/linux/freeradius-3-setup-mysql-eap-ttls/">How to configure FreeRADIUS 3 with MySQL and EAP-TTLS</a>
                    
                        <small>(Categories: <a href="/network">network</a>, <a href="/security">security</a>, <a href="/linux">linux</a>)</small>
                    
                </li>
                
                
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
                
                <li class="relatedPost">
                    <a href="https://carloalbertoscola.it//2018/linux/security/tor-ssh-reverse-tunnel/">TOR SSH Remote Reverse Tunnel - Raspberry Pi</a>
                    
                        <small>(Categories: <a href="/linux">linux</a>, <a href="/security">security</a>)</small>
                    
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    

    
    
        
            
        
            
        
    
        
            
        
            
        
    
        
            
        
            
        
    


    </ul>
    </div>


<div class="PageNavigation">
  
    <a class="prev pull-left" href="https://carloalbertoscola.it//2020/security/digital-forensic-made-easy-autopsy-sleuth/">&laquo; Autopsy - A Digital Forensic Lab</a>
  
  
    <a class="next pull-right" href="https://carloalbertoscola.it//2023/linux/docker/security/how-to-securely-run-docker-containers/">How to securely run Docker containers &raquo;</a>
  
</div>


<div class="disqus-comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* <![CDATA[ */

        var disqus_shortname = "carloalbertoscola-it";
        var disqus_identifier = "carloalbertoscola-it_How to do create and manage Amazon IAM users with Terraform";
        var disqus_title = "How to do create and manage Amazon IAM users with Terraform";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    /* ]]> */
    </script>
</div>

<!-- <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = "https://carloalbertoscola.it/";  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "carloalbertoscola-it_How to do create and manage Amazon IAM users with Terraform"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://carloalbertoscola-it.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>
-->

<script id="dsq-count-scr" src="//carloalbertoscola-it.disqus.com/count.js" async></script> 
          <div class="row">
            <div class="col-md-12 col-xs-12 footer">
              <footer>
  © 2023 - Scola Carlo Alberto <!--<a href="#">Privacy link</a>--> - <a href="/static/albertoscola221@gmail.com.pgp">GPG key </a> - <a href="/cookies">Cookie Policy</a>
</footer>
<!-- <div align="center">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <ins class="adsbygoogle"
    style="display:block"
    data-ad-client="ca-pub-0000000000000000"
    data-ad-slot="0000000000"
    data-ad-format="auto"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
 -->

            </div>
          </div>
        </div> <!-- end /.col-md-9 -->
      </div> <!-- end /.row -->
    </div>

    
<script src="/static/js/jquery.min.js"></script>

<script src="/static/js/bootstrap.min.js"></script>

<!--<script src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>-->
<!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>-->

<script src="/static/js/super-search.js"></script>

<script src="/static/js/thickbox-compressed.js"></script>
<script src="/static/js/material.min.js"></script>
<script src="/static/js/main.js"></script>
<script src="/static/js/projects.js"></script>

    <script>
	var consent = getCookie("cookieconsent_status");
	if( consent == "deny"){
	} else if (consent == null || consent == "allow") {
		eval('(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)  })(window,document,"script","https://www.google-analytics.com/analytics.js","ga");  ga("create", "UA-63063866-5", "auto");  ga("send", "pageview");			');
	}

  // (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  // (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  // m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  // })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  // ga('create', 'UA-63063866-5', 'auto');
  // ga('send', 'pageview');
</script>
  </body>
</html>
